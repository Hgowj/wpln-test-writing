<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WPLN English Writing Tests</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 40px;
            text-align: center;
        }

        .header h1 {
            color: #2d3748;
            font-size: 3em;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #4299e1, #667eea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #718096;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .test-selection {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .test-selection.active {
            display: block;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .test-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 15px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .test-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4299e1, #667eea);
        }

        .test-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border-color: #4299e1;
        }

        .test-card h3 {
            color: #2d3748;
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-icon {
            font-size: 1.8em;
        }

        .test-description {
            color: #4a5568;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .test-features {
            list-style: none;
            padding: 0;
        }

        .test-features li {
            color: #718096;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .test-features li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #48bb78;
            font-weight: bold;
        }

        .back-btn {
            background: linear-gradient(45deg, #718096, #4a5568);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-bottom: 30px;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(113, 128, 150, 0.4);
        }

        .test-section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .test-section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #e2e8f0;
        }

        .section-title {
            color: #2d3748;
            font-size: 1.5em;
            font-weight: bold;
        }

        .timer {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            min-width: 120px;
            text-align: center;
        }

        .timer.warning {
            background: linear-gradient(45deg, #ff9500, #ff6b00);
            animation: pulse 1s infinite;
        }

        .timer.critical {
            background: linear-gradient(45deg, #dc2626, #b91c1c);
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .timer-control {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 20px 0;
            justify-content: center;
        }

        .timer-btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .timer-btn:hover {
            background: #3182ce;
            transform: translateY(-1px);
        }

        .timer-btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
        }

        .question-block {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
            border-left: 4px solid #4299e1;
        }

        .question {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .input-container {
            position: relative;
            margin-bottom: 15px;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .word-counter {
            position: absolute;
            bottom: -25px;
            right: 0;
            font-size: 0.9em;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .word-counter.under {
            background: #fed7d7;
            color: #c53030;
        }

        .word-counter.perfect {
            background: #c6f6d5;
            color: #25543e;
        }

        .word-counter.over {
            background: #fbd38d;
            color: #c05621;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }

        .nav-btn {
            background: linear-gradient(45deg, #4299e1, #3182ce);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 153, 225, 0.4);
        }

        .nav-btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4299e1, #38b2ac);
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .instructions {
            background: #ebf8ff;
            border: 1px solid #bee3f8;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #2c5282;
        }

        .chat-message {
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }

        .chat-author {
            font-weight: bold;
            color: #2f855a;
            margin-bottom: 5px;
        }

        .submit-section {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            border-radius: 15px;
            margin-top: 30px;
            display: none;
        }

        .submit-section.active {
            display: block;
        }

        .submit-btn {
            background: white;
            color: #38a169;
            border: none;
            padding: 15px 50px;
            border-radius: 30px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .test-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .section-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .navigation {
                flex-direction: column;
                gap: 15px;
            }

            .test-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Header -->
        <div class="header">
            <h1>WPLN English Writing Tests</h1>
            <p>Choose from multiple test themes to practice your English writing skills</p>
            <p><strong>Complete assessment with timers, word counters, and realistic exam conditions</strong></p>
        </div>

        <!-- Test Selection Screen -->
        <div class="test-selection active" id="testSelection">
            <h2 style="text-align: center; margin-bottom: 30px; color: #2d3748; font-size: 2em;">Choose Your Test</h2>
            
            <div class="test-grid">
                <!-- Test 1: Travel & Tourism -->
                <div class="test-card" onclick="startTest('travel')">
                    <h3><span class="test-icon">✈️</span>Test 1: Travel & Tourism</h3>
                    <div class="test-description">
                        Join a travel group and explore topics about destinations, adventures, and cultural experiences around the world.
                    </div>
                    <ul class="test-features">
                        <li>Travel group membership scenario</li>
                        <li>Questions about destinations & preferences</li>
                        <li>Chat about travel experiences</li>
                        <li>Handle tour cancellation situation</li>
                    </ul>
                </div>

                <!-- Test 2: Technology & Gaming -->
                <div class="test-card" onclick="startTest('gaming')">
                    <h3><span class="test-icon">🎮</span>Test 2: Technology & Gaming</h3>
                    <div class="test-description">
                        Join a gaming community and discuss your favorite games, platforms, and digital entertainment experiences.
                    </div>
                    <ul class="test-features">
                        <li>Gaming community membership</li>
                        <li>Questions about games & platforms</li>
                        <li>Chat about gaming experiences</li>
                        <li>Handle tournament postponement</li>
                    </ul>
                </div>

                <!-- Test 3: Health & Fitness -->
                <div class="test-card" onclick="startTest('fitness')">
                    <h3><span class="test-icon">💪</span>Test 3: Health & Fitness</h3>
                    <div class="test-description">
                        Join a fitness center and discuss your health goals, workout preferences, and wellness journey.
                    </div>
                    <ul class="test-features">
                        <li>Fitness center membership</li>
                        <li>Questions about fitness goals</li>
                        <li>Chat about workout routines</li>
                        <li>Handle class cancellation issue</li>
                    </ul>
                </div>

                <!-- Test 4: Food & Cooking -->
                <div class="test-card" onclick="startTest('cooking')">
                    <h3><span class="test-icon">👨‍🍳</span>Test 4: Food & Cooking</h3>
                    <div class="test-description">
                        Join a cooking school and explore culinary skills, favorite cuisines, and food preparation techniques.
                    </div>
                    <ul class="test-features">
                        <li>Cooking school enrollment</li>
                        <li>Questions about culinary interests</li>
                        <li>Chat about cooking experiences</li>
                        <li>Handle workshop cancellation</li>
                    </ul>
                </div>

                <!-- Test 5: Arts & Crafts -->
                <div class="test-card" onclick="startTest('arts')">
                    <h3><span class="test-icon">🎨</span>Test 5: Arts & Crafts</h3>
                    <div class="test-description">
                        Join an art studio and discuss your creative interests, artistic techniques, and craft projects.
                    </div>
                    <ul class="test-features">
                        <li>Art studio membership</li>
                        <li>Questions about artistic interests</li>
                        <li>Chat about creative projects</li>
                        <li>Handle workshop equipment issue</li>
                    </ul>
                </div>

                <!-- Test 6: Music & Entertainment -->
                <div class="test-card" onclick="startTest('music')">
                    <h3><span class="test-icon">🎵</span>Test 6: Music & Entertainment</h3>
                    <div class="test-description">
                        Join a music club and explore your musical interests, instruments, and entertainment preferences.
                    </div>
                    <ul class="test-features">
                        <li>Music club membership</li>
                        <li>Questions about musical interests</li>
                        <li>Chat about performances</li>
                        <li>Handle concert cancellation</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Test Content Container -->
        <div id="testContainer" style="display: none;">
            <button class="back-btn" onclick="backToSelection()">← Back to Test Selection</button>
            
            <div class="test-info" id="testInfo"></div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <!-- Test sections will be dynamically loaded here -->
            <div id="dynamicSections"></div>

            <div class="navigation">
                <button class="nav-btn" id="prevBtn" onclick="changeSection(-1)" disabled>← Previous</button>
                <button class="nav-btn" id="nextBtn" onclick="changeSection(1)">Next →</button>
            </div>

            <div class="submit-section" id="submitSection">
                <h2 style="color: white; margin-bottom: 20px;">Ready to Submit?</h2>
                <p style="color: white; margin-bottom: 30px;">Please review your answers before submitting your test.</p>
                <button class="submit-btn" onclick="submitTest()">Submit Test</button>
            </div>
        </div>
    </div>

    <script>
        let currentTest = '';
        let currentSection = 1;
        const totalSections = 4;
        let timers = {};
        let intervals = {};
        let originalTimes = {
            1: 180,   // 3 minutes
            2: 420,   // 7 minutes  
            3: 600,   // 10 minutes
            4: 1800   // 30 minutes
        };

        // Test data
        const testData = {
            travel: {
                title: "Travel & Tourism Test",
                icon: "✈️",
                part1: {
                    scenario: "You want to join a travel group. You have 5 messages from a member of the group. Write short answers (1-5 words) to each message.",
                    questions: [
                        "What's your dream destination?",
                        "How do you prefer to travel?",
                        "What's your travel budget range?",
                        "Do you like adventure activities?",
                        "When can you take holidays?"
                    ]
                },
                part2: {
                    title: "Global Explorers Travel Group",
                    question: "Please write some of the reasons why you enjoy traveling to new places."
                },
                part3: {
                    title: "Global Explorers Chat",
                    chats: [
                        { author: "Marco", message: "Hi! I just got back from hiking in Nepal. The mountains were incredible! What's the most exciting trip you've taken?" },
                        { author: "Priya", message: "Welcome! Can you tell me about a local dish from your country that travelers should try?" },
                        { author: "Ahmed", message: "What type of accommodation do you prefer when traveling, and why do you like staying there?" }
                    ]
                },
                part4: {
                    scenario: "You booked a cultural tour through the travel group. You received this email:",
                    email: "Dear Traveler, We regret to inform you that the cultural tour scheduled for next weekend has been cancelled due to heavy rainfall warnings. We will refund your tour fee, but unfortunately cannot cover your pre-booked hotel costs. We apologize for this short notice.",
                    task1: "Write a message to your friend about your feelings and what you think the group should do about the situation. Write about 40-50 words. You have 10 minutes.",
                    task2: "Write an email to the tour company manager about your feelings and what you think they should do about the situation. Write 120-150 words. You have 20 minutes."
                }
            },
            gaming: {
                title: "Technology & Gaming Test",
                icon: "🎮",
                part1: {
                    scenario: "You want to join a gaming community. You have 5 messages from a member. Write short answers (1-5 words) to each message.",
                    questions: [
                        "Which games do you play?",
                        "What's your gaming platform?",
                        "How many hours daily?",
                        "Do you stream online?",
                        "What's your skill level?"
                    ]
                },
                part2: {
                    title: "Digital Warriors Gaming Community",
                    question: "Please write some of the reasons why you enjoy playing video games."
                },
                part3: {
                    title: "Digital Warriors Chat",
                    chats: [
                        { author: "Kyle", message: "Hey! I'm really into strategy games and spend most evenings playing online. What type of games get you excited?" },
                        { author: "Zara", message: "Welcome! Can you recommend a mobile game that's perfect for playing during commute time?" },
                        { author: "Dev", message: "What's the most challenging game you've ever completed, and what made it so difficult to finish?" }
                    ]
                },
                part4: {
                    scenario: "You registered for an esports tournament through the gaming community. You received this email:",
                    email: "Dear Participant, The esports tournament scheduled for this Saturday has been postponed due to technical server issues. Registration fees will be refunded, but we cannot reimburse travel expenses already incurred. We apologize for the inconvenience.",
                    task1: "Write a message to your gaming buddy about your feelings and what you think the organizers should do. Write about 40-50 words. You have 10 minutes.",
                    task2: "Write an email to the tournament organizers about your feelings and what you think they should do about the situation. Write 120-150 words. You have 20 minutes."
                }
            },
            fitness: {
                title: "Health & Fitness Test",
                icon: "💪",
                part1: {
                    scenario: "You want to join a fitness center. You have 5 messages from a staff member. Write short answers (1-5 words) to each message.",
                    questions: [
                        "Which exercises do you enjoy?",
                        "How often can you workout?",
                        "Do you have injuries?",
                        "What's your experience level?",
                        "Preferred workout time?"
                    ]
                },
                part2: {
                    title: "FitLife Wellness Center",
                    question: "Please write some of the reasons why you want to improve your physical fitness."
                },
                part3: {
                    title: "FitLife Community Chat",
                    chats: [
                        { author: "Sarah", message: "Hi there! I love morning yoga classes and try to attend three times weekly. What's your favorite way to stay active?" },
                        { author: "Miguel", message: "Welcome! Can you share a healthy snack recipe that gives you energy before workouts?" },
                        { author: "Jenny", message: "What motivates you to exercise when you're feeling tired, and how do you push through difficult days?" }
                    ]
                },
                part4: {
                    scenario: "You signed up for a fitness bootcamp through the center. You received this email:",
                    email: "Dear Member, We must cancel tomorrow's outdoor bootcamp session due to air quality concerns from nearby construction. Your class fee will be credited to your account, but we cannot compensate for any childcare arrangements made. We apologize for the late notice.",
                    task1: "Write a text message to your workout partner about your feelings and what you think the center should do. Write about 40-50 words. You have 10 minutes.",
                    task2: "Write an email to the fitness center manager about your feelings and what you think they should do about the situation. Write 120-150 words. You have 20 minutes."
                }
            },
            cooking: {
                title: "Food & Cooking Test",
                icon: "👨‍🍳",
                part1: {
                    scenario: "You want to join a cooking class. You have 5 messages from the instructor. Write short answers (1-5 words) to each message.",
                    questions: [
                        "Which cuisine interests you?",
                        "Do you have allergies?",
                        "What cooking tools do you own?",
                        "How often do you cook?",
                        "Preferred class schedule?"
                    ]
                },
                part2: {
                    title: "Gourmet Kitchen Cooking School",
                    question: "Please write some of the reasons why you want to learn cooking skills."
                },
                part3: {
                    title: "Gourmet Kitchen Chat",
                    chats: [
                        { author: "Chef Maria", message: "Hello! I specialize in Mediterranean cuisine and teach knife skills every Tuesday. What type of cooking would you like to master?" },
                        { author: "Tom", message: "Welcome! Can you describe the most memorable meal you've ever eaten and what made it special?" },
                        { author: "Lisa", message: "What's your biggest cooking disaster story, and what important lesson did you learn from that experience?" }
                    ]
                },
                part4: {
                    scenario: "You enrolled in a specialized baking workshop through the cooking school. You received this email:",
                    email: "Dear Student, The artisan bread workshop scheduled for Sunday has been cancelled because our master baker is ill. Workshop fees will be refunded, but we cannot reimburse the cost of ingredients you purchased in advance. We sincerely apologize for this disruption.",
                    task1: "Write a WhatsApp message to your cooking buddy about your feelings and what you think the school should do. Write about 40-50 words. You have 10 minutes.",
                    task2: "Write an email to the cooking school director about your feelings and what you think they should do about the situation. Write 120-150 words. You have 20 minutes."
                }
            },
            arts: {
                title: "Arts & Crafts Test",
                icon: "🎨",
                part1: {
                    scenario: "You want to join an art studio. You have 5 messages from a member. Write short answers (1-5 words) to each message.",
                    questions: [
                        "Have you taken classes before?",
                        "What inspires your creativity?",
                        "How much time weekly?",
                        "Do you sell artwork?",
                        "Favorite art style?"
                    ]
                },
                part2: {
                    title: "Creative Minds Art Studio",
                    question: "Please write some of the reasons why you enjoy creating art and crafts."
                },
                part3: {
                    title: "Creative Minds Chat",
                    chats: [
                        { author: "Isabella", message: "Hi! I work with clay pottery and love the therapeutic feeling of shaping with my hands. What art form helps you relax?" },
                        { author: "Oliver", message: "Welcome! Can you tell me about an artwork that has deeply influenced your own creative style or approach?" },
                        { author: "Maya", message: "What's the most challenging art project you've attempted, and how did you overcome the technical difficulties you faced?" }
                    ]
                },
                part4: {
                    scenario: "You registered for a sculpture workshop through the art studio. You received this email:",
                    email: "Dear Artist, The bronze sculpture workshop planned for next weekend has been cancelled due to equipment malfunction in our foundry. Registration fees will be returned, but we cannot refund materials you ordered specifically for this workshop. We deeply regret this inconvenience.",
                    task1: "Write an Instagram message to your artist friend about your feelings and what you think the studio should do. Write about 40-50 words. You have 10 minutes.",
                    task2: "Write an email to the art studio owner about your feelings and what you think they should do about the situation. Write 120-150 words. You have 20 minutes."
                }
            },
            music: {
                title: "Music & Entertainment Test",
                icon: "🎵",
                part1: {
                    scenario: "You want to join a music club. You have 5 messages from a member. Write short answers (1-5 words) to each message.",
                    questions: [
                        "What instruments do you play?",
                        "Favorite music genre?",
                        "Do you perform publicly?",
                        "How often do you practice?",
                        "Preferred meeting time?"
                    ]
                },
                part2: {
                    title: "Harmony Music Club",
                    question: "Please write some of the reasons why you are passionate about music and musical activities."
                },
                part3: {
                    title: "Harmony Music Chat",
                    chats: [
                        { author: "Emma", message: "Hi! I play violin in our local orchestra and love classical music. What type of music do you enjoy performing or listening to?" },
                        { author: "Jake", message: "Welcome! Can you tell me about a memorable concert or musical performance you've attended that really moved you?" },
                        { author: "Sofia", message: "What's the most challenging piece of music you've learned, and what techniques helped you master it?" }
                    ]
                },
                part4: {
                    scenario: "You bought tickets for a club concert through the music club. You received this email:",
                    email: "Dear Music Lover, We regret to announce that tonight's concert has been cancelled due to the lead performer's sudden illness. Ticket refunds will be processed, but we cannot compensate for parking fees or transportation costs already incurred. We apologize for this last-minute cancellation.",
                    task1: "Write a text message to your friend about your feelings and what you think the club should do. Write about 40-50 words. You have 10 minutes.",
                    task2: "Write an email to the music club coordinator about your feelings and what you think they should do about the situation. Write 120-150 words. You have 20 minutes."
                }
            }
        };

        // Word count targets
        const wordTargets = {
            'p1q1': { min: 1, max: 5 }, 'p1q2': { min: 1, max: 5 }, 'p1q3': { min: 1, max: 5 }, 'p1q4': { min: 1, max: 5 }, 'p1q5': { min: 1, max: 5 },
            'p2q1': { min: 20, max: 30 },
            'p3q1': { min: 30, max: 40 }, 'p3q2': { min: 30, max: 40 }, 'p3q3': { min: 30, max: 40 },
            'p4q1': { min: 40, max: 50 }, 'p4q2': { min: 120, max: 150 }
        };

        function startTest(testType) {
            currentTest = testType;
            currentSection = 1;
            
            // Hide test selection, show test container
            document.getElementById('testSelection').classList.remove('active');
            document.getElementById('testContainer').style.display = 'block';
            
            // Set test info
            const testInfo = document.getElementById('testInfo');
            testInfo.innerHTML = `<strong>${testData[testType].icon} ${testData[testType].title}</strong> - Complete all 4 parts following the word count guidelines and time limits.`;
            
            // Initialize timers
            initializeTimers();
            
            // Generate test sections
            generateTestSections(testType);
            
            // Show first section
            showSection(1);
            updateProgress();
        }

        function backToSelection() {
            // Clear all timers
            for (let section = 1; section <= 4; section++) {
                if (intervals[section]) {
                    clearInterval(intervals[section]);
                    intervals[section] = null;
                }
            }
            
            // Reset timers
            timers = {};
            initializeTimers();
            
            // Clear form data
            document.getElementById('dynamicSections').innerHTML = '';
            
            // Show selection screen
            document.getElementById('testContainer').style.display = 'none';
            document.getElementById('testSelection').classList.add('active');
            
            currentTest = '';
            currentSection = 1;
        }

        function generateTestSections(testType) {
            const data = testData[testType];
            const container = document.getElementById('dynamicSections');
            
            container.innerHTML = `
                <!-- Part 1: Word-level writing -->
                <div class="test-section" id="part1">
                    <div class="section-header">
                        <div class="section-title">Part 1: Word-level Writing</div>
                        <div class="timer" id="timer1">03:00</div>
                    </div>
                    
                    <div class="timer-control">
                        <button class="timer-btn" id="startBtn1" onclick="startTimer(1, 180)">Start Timer</button>
                        <button class="timer-btn" id="pauseBtn1" onclick="pauseTimer(1)" disabled>Pause</button>
                        <button class="timer-btn" id="resetBtn1" onclick="resetTimer(1, 180)">Reset</button>
                    </div>
                    
                    <div class="instructions">
                        ${data.part1.scenario}
                    </div>

                    <div class="question-block">
                        <div class="question">Example: What's your name?</div>
                        <div class="input-container">
                            <input type="text" placeholder="Sarah Johnson" disabled style="background: #f7fafc;">
                        </div>
                    </div>

                    ${data.part1.questions.map((q, i) => `
                        <div class="question-block">
                            <div class="question">${q}</div>
                            <div class="input-container">
                                <input type="text" id="p1q${i+1}" maxlength="25">
                                <div class="word-counter" id="p1q${i+1}-counter">0 words</div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <!-- Part 2: Short text writing -->
                <div class="test-section" id="part2">
                    <div class="section-header">
                        <div class="section-title">Part 2: Short Text Writing</div>
                        <div class="timer" id="timer2">07:00</div>
                    </div>
                    
                    <div class="timer-control">
                        <button class="timer-btn" id="startBtn2" onclick="startTimer(2, 420)">Start Timer</button>
                        <button class="timer-btn" id="pauseBtn2" onclick="pauseTimer(2)" disabled>Pause</button>
                        <button class="timer-btn" id="resetBtn2" onclick="resetTimer(2, 420)">Reset</button>
                    </div>
                    
                    <div class="instructions">
                        You are a new member of the ${data.part2.title.split(' ').slice(-2).join(' ').toLowerCase()}. Fill in the form. Write in sentences. Use 20-30 words. You have 7 minutes.
                    </div>

                    <div class="question-block">
                        <div class="question">${data.part2.title}</div>
                        <p>${data.part2.question}</p>
                        <div class="input-container">
                            <textarea id="p2q1" placeholder="Write your response here..."></textarea>
                            <div class="word-counter" id="p2q1-counter">0 words (Target: 20-30 words)</div>
                        </div>
                    </div>
                </div>

                <!-- Part 3: Three written parts -->
                <div class="test-section" id="part3">
                    <div class="section-header">
                        <div class="section-title">Part 3: Social Interaction</div>
                        <div class="timer" id="timer3">10:00</div>
                    </div>
                    
                    <div class="timer-control">
                        <button class="timer-btn" id="startBtn3" onclick="startTimer(3, 600)">Start Timer</button>
                        <button class="timer-btn" id="pauseBtn3" onclick="pauseTimer(3)" disabled>Pause</button>
                        <button class="timer-btn" id="resetBtn3" onclick="resetTimer(3, 600)">Reset</button>
                    </div>
                    
                    <div class="instructions">
                        You are a member of the ${data.part3.title.split(' ').slice(0, -1).join(' ').toLowerCase()}. You are talking to three other members in the chat room. Talk to them using sentences. Use 30-40 words per answer. Answer all three questions.
                    </div>

                    ${data.part3.chats.map((chat, i) => `
                        <div class="question-block">
                            <div class="chat-message">
                                <div class="chat-author">${chat.author}:</div>
                                ${chat.message}
                            </div>
                            <div class="input-container">
                                <textarea id="p3q${i+1}" placeholder="Type your response..."></textarea>
                                <div class="word-counter" id="p3q${i+1}-counter">0 words (Target: 30-40 words)</div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <!-- Part 4: Formal and informal writing -->
                <div class="test-section" id="part4">
                    <div class="section-header">
                        <div class="section-title">Part 4: Formal and Informal Writing</div>
                        <div class="timer" id="timer4">30:00</div>
                    </div>
                    
                    <div class="timer-control">
                        <button class="timer-btn" id="startBtn4" onclick="startTimer(4, 1800)">Start Timer</button>
                        <button class="timer-btn" id="pauseBtn4" onclick="pauseTimer(4)" disabled>Pause</button>
                        <button class="timer-btn" id="resetBtn4" onclick="resetTimer(4, 1800)">Reset</button>
                    </div>
                    
                    <div class="instructions">
                        ${data.part4.scenario}
                        <br><br>
                        <em>"${data.part4.email}"</em>
                    </div>

                    <div class="question-block">
                        <div class="question">Task 1: ${data.part4.task1}</div>
                        <div class="input-container">
                            <textarea id="p4q1" placeholder="Write your informal message here..."></textarea>
                            <div class="word-counter" id="p4q1-counter">0 words (Target: 40-50 words)</div>
                        </div>
                    </div>

                    <div class="question-block">
                        <div class="question">Task 2: ${data.part4.task2}</div>
                        <div class="input-container">
                            <textarea id="p4q2" style="min-height: 200px;" placeholder="Write your formal email here..."></textarea>
                            <div class="word-counter" id="p4q2-counter">0 words (Target: 120-150 words)</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Initialize word counters after generating content
            setTimeout(() => {
                Object.keys(wordTargets).forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.addEventListener('input', () => updateWordCounter(inputId));
                        input.addEventListener('paste', () => {
                            setTimeout(() => updateWordCounter(inputId), 10);
                        });
                        updateWordCounter(inputId);
                    }
                });
            }, 100);
        }

        function showSection(sectionNum) {
            // Hide all sections
            for (let i = 1; i <= totalSections; i++) {
                const section = document.getElementById(`part${i}`);
                if (section) {
                    section.classList.remove('active');
                    section.style.display = 'none';
                }
            }
            
            // Show current section
            const currentSectionElement = document.getElementById(`part${sectionNum}`);
            if (currentSectionElement) {
                currentSectionElement.classList.add('active');
                currentSectionElement.style.display = 'block';
            }
        }

        function updateProgress() {
            const progress = (currentSection / totalSections) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentSection === 1;
            document.getElementById('nextBtn').disabled = currentSection === totalSections;
            
            // Show/hide submit section
            const submitSection = document.getElementById('submitSection');
            if (currentSection === totalSections) {
                submitSection.classList.add('active');
                document.getElementById('nextBtn').style.display = 'none';
            } else {
                submitSection.classList.remove('active');
                document.getElementById('nextBtn').style.display = 'block';
            }
        }

        function changeSection(direction) {
            const newSection = currentSection + direction;
            
            if (newSection < 1 || newSection > totalSections) return;
            
            // Pause current section timer when leaving
            if (intervals[currentSection]) {
                pauseTimer(currentSection);
            }
            
            currentSection = newSection;
            showSection(currentSection);
            updateProgress();
        }

        // Timer functions
        function startTimer(section, seconds) {
            if (intervals[section]) {
                clearInterval(intervals[section]);
            }
            
            if (!timers[section]) {
                timers[section] = seconds;
            }
            
            const startBtn = document.getElementById(`startBtn${section}`);
            const pauseBtn = document.getElementById(`pauseBtn${section}`);
            
            startBtn.disabled = true;
            pauseBtn.disabled = false;
            
            intervals[section] = setInterval(() => {
                timers[section]--;
                updateTimerDisplay(section);
                
                if (timers[section] <= 0) {
                    clearInterval(intervals[section]);
                    onTimerComplete(section);
                }
            }, 1000);
        }

        function pauseTimer(section) {
            if (intervals[section]) {
                clearInterval(intervals[section]);
                intervals[section] = null;
            }
            
            const startBtn = document.getElementById(`startBtn${section}`);
            const pauseBtn = document.getElementById(`pauseBtn${section}`);
            
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            startBtn.textContent = 'Resume';
        }

        function resetTimer(section, seconds) {
            if (intervals[section]) {
                clearInterval(intervals[section]);
                intervals[section] = null;
            }
            
            timers[section] = seconds;
            updateTimerDisplay(section);
            
            const startBtn = document.getElementById(`startBtn${section}`);
            const pauseBtn = document.getElementById(`pauseBtn${section}`);
            const timerDisplay = document.getElementById(`timer${section}`);
            
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            startBtn.textContent = 'Start Timer';
            
            // Reset timer styling
            timerDisplay.className = 'timer';
        }

        function updateTimerDisplay(section) {
            const timerDisplay = document.getElementById(`timer${section}`);
            if (!timerDisplay) return;
            
            const minutes = Math.floor(timers[section] / 60);
            const seconds = timers[section] % 60;
            
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            timerDisplay.textContent = timeString;
            
            // Update timer styling based on remaining time
            const originalTime = originalTimes[section];
            const percentRemaining = (timers[section] / originalTime) * 100;
            
            timerDisplay.className = 'timer';
            
            if (percentRemaining <= 10) {
                timerDisplay.classList.add('critical');
            } else if (percentRemaining <= 25) {
                timerDisplay.classList.add('warning');
            }
        }

        function onTimerComplete(section) {
            const timerDisplay = document.getElementById(`timer${section}`);
            const startBtn = document.getElementById(`startBtn${section}`);
            const pauseBtn = document.getElementById(`pauseBtn${section}`);
            
            if (timerDisplay) {
                timerDisplay.textContent = 'TIME UP!';
                timerDisplay.className = 'timer critical';
            }
            
            if (startBtn) startBtn.disabled = true;
            if (pauseBtn) pauseBtn.disabled = true;
            
            alert(`Time's up for Part ${section}!`);
        }

        function initializeTimers() {
            for (let section = 1; section <= 4; section++) {
                timers[section] = originalTimes[section];
                // Don't update display here as elements might not exist yet
            }
        }

        function countWords(text) {
            return text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
        }

        function updateWordCounter(inputId) {
            const input = document.getElementById(inputId);
            const counter = document.getElementById(inputId + '-counter');
            const target = wordTargets[inputId];
            
            if (!input || !counter || !target) return;
            
            const wordCount = countWords(input.value);
            const isUnder = wordCount < target.min;
            const isPerfect = wordCount >= target.min && wordCount <= target.max;
            const isOver = wordCount > target.max;
            
            // Update counter text
            if (inputId.startsWith('p1')) {
                counter.textContent = `${wordCount} words (1-5 words)`;
            } else if (inputId === 'p2q1') {
                counter.textContent = `${wordCount} words (Target: 20-30 words)`;
            } else if (inputId.startsWith('p3')) {
                counter.textContent = `${wordCount} words (Target: 30-40 words)`;
            } else if (inputId === 'p4q1') {
                counter.textContent = `${wordCount} words (Target: 40-50 words)`;
            } else if (inputId === 'p4q2') {
                counter.textContent = `${wordCount} words (Target: 120-150 words)`;
            }
            
            // Update counter styling
            counter.className = 'word-counter';
            if (isPerfect) {
                counter.classList.add('perfect');
            } else if (isOver) {
                counter.classList.add('over');
            } else {
                counter.classList.add('under');
            }
        }

        function submitTest() {
            // Pause all timers
            for (let section = 1; section <= 4; section++) {
                if (intervals[section]) {
                    clearInterval(intervals[section]);
                }
            }
            
            if (confirm('Are you sure you want to submit your test? You cannot make changes after submission.')) {
                // Collect all answers
                const answers = {
                    testType: currentTest,
                    testTitle: testData[currentTest].title,
                    submissionTime: new Date().toISOString()
                };
                
                // Collect Part 1 answers
                for (let i = 1; i <= 5; i++) {
                    const input = document.getElementById(`p1q${i}`);
                    if (input) {
                        answers[`part1_q${i}`] = {
                            answer: input.value,
                            wordCount: countWords(input.value)
                        };
                    }
                }
                
                // Collect Part 2 answer
                const p2input = document.getElementById('p2q1');
                if (p2input) {
                    answers['part2_q1'] = {
                        answer: p2input.value,
                        wordCount: countWords(p2input.value)
                    };
                }
                
                // Collect Part 3 answers
                for (let i = 1; i <= 3; i++) {
                    const input = document.getElementById(`p3q${i}`);
                    if (input) {
                        answers[`part3_q${i}`] = {
                            answer: input.value,
                            wordCount: countWords(input.value)
                        };
                    }
                }
                
                // Collect Part 4 answers
                for (let i = 1; i <= 2; i++) {
                    const input = document.getElementById(`p4q${i}`);
                    if (input) {
                        answers[`part4_q${i}`] = {
                            answer: input.value,
                            wordCount: countWords(input.value)
                        };
                    }
                }
                
                // Include timer data
                answers.timerData = {
                    timeRemaining: {...timers},
                    originalTimes: {...originalTimes}
                };
                
                console.log('Test submitted:', answers);
                alert(`${testData[currentTest].title} submitted successfully! Your answers have been recorded.`);
                
                // Reset to selection screen
                backToSelection();
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeTimers();
        });

        // Auto-save functionality
        let autoSaveData = {};
        
        function autoSave() {
            if (currentTest) {
                autoSaveData[currentTest] = {};
                Object.keys(wordTargets).forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        autoSaveData[currentTest][inputId] = input.value;
                    }
                });
                autoSaveData[currentTest].timers = {...timers};
                console.log('Auto-saved progress for', currentTest);
            }
        }
        
        // Auto-save every 30 seconds
        setInterval(autoSave, 30000);
        
        // Prevent accidental page refresh during test
        window.addEventListener('beforeunload', function (e) {
            if (currentTest) {
                const hasContent = Object.keys(wordTargets).some(inputId => {
                    const input = document.getElementById(inputId);
                    return input && input.value.trim() !== '';
                });
                
                if (hasContent) {
                    e.preventDefault();
                    e.returnValue = 'You have unsaved test progress. Are you sure you want to leave?';
                    return e.returnValue;
                }
            }
        });
    </script>
</body>
</html>
